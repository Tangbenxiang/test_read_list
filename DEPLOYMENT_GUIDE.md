# 儿童阅读记录小程序 - 部署和测试指南

## 1. 环境准备

### 1.1 开发工具
1. 下载并安装 [微信开发者工具](https://developers.weixin.qq.com/miniprogram/dev/devtools/download.html)
2. 注册微信小程序账号（如已有请忽略）
3. 获取小程序AppID

### 1.2 项目导入
1. 打开微信开发者工具
2. 选择"导入项目"
3. 选择本项目目录
4. 输入你的AppID
5. 点击"导入"

## 2. 云开发配置

### 2.1 开通云开发
1. 在微信开发者工具中，点击顶部"云开发"按钮
2. 按照提示开通云开发服务
3. 创建云开发环境（如：`book-record-env`）
4. 记录环境ID

### 2.2 更新环境配置
在 `app.js` 中更新环境ID：

```javascript
wx.cloud.init({
  env: '你的环境ID', // 替换为实际环境ID
  traceUser: true,
})
```

## 3. 数据库配置

### 3.1 创建books集合
1. 进入云开发控制台 → 数据库
2. 点击"+"号创建新集合，命名为 `books`
3. 权限设置：建议设置为：
   - 所有用户可读
   - 仅创建者可写

### 3.2 添加测试数据（可选）
如需添加测试数据，可以在云控制台手动添加或使用以下JSON格式导入：

```json
[
  {
    "serial": 1,
    "title": "《安徒生童话》",
    "type": "童话",
    "author": "安徒生",
    "description": "包含《丑小鸭》、《卖火柴的小女孩》等经典童话故事",
    "gradeLevel": "一至二年级",
    "purchased": true,
    "read": true,
    "intensiveRead": false,
    "cover": ""
  },
  {
    "serial": 2,
    "title": "《十万个为什么》",
    "type": "科普",
    "author": "少年儿童出版社",
    "description": "解答儿童常见科学问题，培养科学兴趣",
    "gradeLevel": "三至四年级",
    "purchased": true,
    "read": false,
    "intensiveRead": false,
    "cover": ""
  },
  {
    "serial": 3,
    "title": "《西游记》青少版",
    "type": "古典文学",
    "author": "吴承恩",
    "description": "中国古典四大名著之一，适合青少年阅读的版本",
    "gradeLevel": "五至六年级",
    "purchased": true,
    "read": true,
    "intensiveRead": true,
    "cover": ""
  }
]
```

## 4. 云函数部署

### 4.1 上传云函数
1. 在微信开发者工具中，右键点击 `cloudfunctions` 目录
2. 选择"当前环境"
3. 为每个云函数文件夹执行：
   - 右键点击文件夹（如 `getCategoryStats`）
   - 选择"上传并部署：云端安装依赖"
   - 等待部署完成

### 4.2 需要部署的云函数
- `getCategoryStats` - 获取分类统计数据
- `searchBooks` - 搜索书籍
- `updateBookStatus` - 更新书籍状态
- `initDatabase` - 数据库初始化检查（可选）

## 5. 功能测试

### 5.1 首页测试
1. 运行小程序，进入首页
2. 检查页面是否正常显示
3. 检查统计数据是否正确显示
4. 测试各分类卡片点击跳转
5. 测试快捷入口跳转
6. 测试搜索框跳转

### 5.2 书籍列表页测试
1. 从首页点击任一分类进入列表页
2. 检查书籍列表是否正常显示
3. 测试筛选功能：
   - 点击筛选按钮打开筛选面板
   - 选择不同筛选条件
   - 点击"应用筛选"查看结果
   - 测试筛选标签的移除功能
4. 测试上拉加载更多（如有足够数据）
5. 测试书籍卡片点击跳转到详情页

### 5.3 书籍详情页测试
1. 从列表页点击书籍进入详情页
2. 检查书籍信息是否正确显示
3. 测试状态切换功能：
   - 点击"已购买"状态切换
   - 点击"已阅读"状态切换
   - 点击"已精读"状态切换
   - 检查状态更新后UI变化
4. 测试分享功能
5. 测试返回功能

### 5.4 搜索页测试
1. 从首页点击搜索框进入搜索页
2. 测试搜索功能：
   - 输入关键词（如"童话"）
   - 点击搜索或按回车
   - 检查搜索结果
   - 测试搜索历史记录
   - 测试热门搜索标签
3. 测试搜索结果点击跳转
4. 测试清空搜索历史

## 6. 数据导入（300+书籍）

### 6.1 准备数据
1. 将Excel表格转换为JSON格式
2. 使用提供的Python脚本或在线转换工具
3. 确保JSON格式正确

### 6.2 导入数据
1. 进入云开发控制台 → 数据库 → books集合
2. 点击"导入"按钮
3. 选择转换好的JSON文件
4. 设置导入模式为"新增记录"
5. 点击"导入"开始批量导入

### 6.3 验证数据
1. 导入后检查数据总量是否正确
2. 随机抽查几条记录验证字段完整性
3. 测试各页面功能是否正常

## 7. 样式优化

### 7.1 图片资源
1. 准备所需的图片文件（参考 `images/README.md`）
2. 将图片放入 `images` 目录
3. 在代码中替换Emoji占位符

### 7.2 主题调整
1. 可在 `app.wxss` 中调整CSS变量值
2. 修改颜色方案以适应偏好
3. 调整字体大小和间距

## 8. 常见问题

### 8.1 云函数调用失败
- 检查云开发环境是否已开通
- 检查云函数是否已部署
- 检查网络连接

### 8.2 数据库查询失败
- 检查集合名称是否正确（应为 `books`）
- 检查字段名称是否匹配
- 检查权限设置

### 8.3 页面显示异常
- 检查控制台错误信息
- 检查CSS样式是否正确加载
- 检查数据格式是否符合预期

### 8.4 模拟数据问题
- 开发阶段使用模拟数据
- 部署后需配置真实数据
- 云函数失败时会自动使用模拟数据

## 9. 扩展功能建议

### 9.1 短期可添加
1. 阅读记录日期跟踪
2. 阅读笔记功能
3. 成就系统

### 9.2 长期规划
1. 多孩子账户支持
2. 阅读计划制定
3. 智能推荐系统

## 10. 发布上线

### 10.1 测试完善
1. 完成所有功能测试
2. 修复发现的bug
3. 优化用户体验

### 10.2 提交审核
1. 在微信开发者工具中点击"上传"
2. 填写版本信息和备注
3. 提交审核

### 10.3 发布版本
1. 审核通过后，在管理后台发布版本
2. 设置合适的发布范围
3. 监控用户反馈和数据

## 支持与反馈

如有问题，请参考：
- 微信小程序官方文档
- 云开发文档
- 项目代码注释

祝你使用愉快！