<!-- pages/search/search.wxml -->
<view class="container page-content">
  <!-- æœç´¢æ¡† -->
  <view class="search-box">
    <view class="search-input-wrapper">
      <view class="search-icon">ğŸ”</view>
      <input
        class="search-input"
        placeholder="æœç´¢ä¹¦åã€ä½œè€…æˆ–ç±»å‹"
        placeholder-class="placeholder"
        value="{{keyword}}"
        bindinput="onInput"
        bindconfirm="onSearch"
        focus="{{autoFocus}}"
      />
      <view wx:if="{{keyword}}" class="clear-btn" bindtap="clearKeyword">Ã—</view>
    </view>
    <view class="search-btn" bindtap="onSearch">æœç´¢</view>
  </view>

  <!-- æœç´¢æç¤º -->
  <view wx:if="{{showSuggestions && keyword}}" class="suggestions">
    <view class="suggestion-item" bindtap="searchWithKeyword" data-keyword="{{keyword}}">
      æœç´¢ "{{keyword}}"
    </view>
    <view wx:if="{{recentKeywords.length > 0}}" class="suggestion-section">
      <text class="suggestion-title">æœ€è¿‘æœç´¢</text>
      <block wx:for="{{recentKeywords}}" wx:key="index">
        <view class="suggestion-item" bindtap="searchWithKeyword" data-keyword="{{item}}">
          {{item}}
        </view>
      </block>
    </view>
  </view>

  <!-- æœç´¢ç»“æœ -->
  <view wx:if="{{showResults}}" class="search-results">
    <view class="results-header">
      <text class="results-title">æœç´¢ç»“æœ</text>
      <text class="results-count">{{total}}æ¡</text>
    </view>

    <scroll-view
      class="results-list"
      scroll-y
      bindscrolltolower="loadMore"
      lower-threshold="100"
      enable-back-to-top
    >
      <block wx:for="{{results}}" wx:key="_id">
        <view class="result-item" bindtap="goToDetail" data-id="{{item._id}}">
          <view class="result-header">
            <text class="result-title">
              <text class="highlight">{{keyword}}</text>
              <text>{{item.title.split(keyword).join('')}}</text>
            </text>
            <view class="result-status">
              <text wx:if="{{item.purchased}}" class="status-icon purchased">âœ“</text>
              <text wx:if="{{item.read}}" class="status-icon read">ğŸ‘</text>
              <text wx:if="{{item.intensiveRead}}" class="status-icon intensive">â­</text>
            </view>
          </view>
          <text class="result-author">{{item.author}}</text>
          <text class="result-type">{{item.type}} Â· {{item.gradeLevel}}</text>
          <text class="result-desc">
            {{item.description ? highlightText(item.description, keyword) : 'æš‚æ— ç®€ä»‹'}}
          </text>
        </view>
      </block>

      <!-- åŠ è½½æç¤º -->
      <view wx:if="{{loading}}" class="loading">
        <view class="loading-icon">â³</view>
        <text>åŠ è½½ä¸­...</text>
      </view>
      <view wx:if="{{!hasMore && results.length > 0}}" class="no-more">
        <text>æ²¡æœ‰æ›´å¤šç»“æœäº†</text>
      </view>
      <view wx:if="{{results.length === 0 && !loading && showResults}}" class="empty">
        <view class="empty-icon">ğŸ”</view>
        <text class="empty-text">æœªæ‰¾åˆ°ç›¸å…³ä¹¦ç±</text>
        <text class="empty-desc">æ¢ä¸ªå…³é”®è¯è¯•è¯•å§</text>
      </view>
    </scroll-view>
  </view>

  <!-- å†å²è®°å½• -->
  <view wx:if="{{!showResults && recentKeywords.length > 0}}" class="history-section">
    <view class="history-header">
      <text class="history-title">æœç´¢å†å²</text>
      <view class="clear-history" bindtap="clearHistory">æ¸…ç©º</view>
    </view>
    <view class="history-tags">
      <block wx:for="{{recentKeywords}}" wx:key="index">
        <view class="history-tag" bindtap="searchWithKeyword" data-keyword="{{item}}">
          {{item}}
        </view>
      </block>
    </view>
  </view>

  <!-- çƒ­é—¨æœç´¢ -->
  <view wx:if="{{!showResults}}" class="hot-section">
    <text class="hot-title">çƒ­é—¨æœç´¢</text>
    <view class="hot-tags">
      <view class="hot-tag" bindtap="searchWithKeyword" data-keyword="ç«¥è¯">ç«¥è¯</view>
      <view class="hot-tag" bindtap="searchWithKeyword" data-keyword="ç§‘æ™®">ç§‘æ™®</view>
      <view class="hot-tag" bindtap="searchWithKeyword" data-keyword="å®‰å¾’ç”Ÿ">å®‰å¾’ç”Ÿ</view>
      <view class="hot-tag" bindtap="searchWithKeyword" data-keyword="ä¸€å¹´çº§">ä¸€å¹´çº§</view>
      <view class="hot-tag" bindtap="searchWithKeyword" data-keyword="ç»å…¸">ç»å…¸</view>
    </view>
  </view>
</view>